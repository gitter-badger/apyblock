#!/bin/bash
# A Shell Blocker
# Block annoying ADs with a single script.
# Copyright 2015, Federico Dami√°n Schonborn <federicodamians@gmail.com>
# License: GPLv2

# Configurations:

# Set the webpage for downloading the /etc/hosts file:
file_source="https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts"

# Functions:

# Print error via notify-send:
send_error() {
  echo -e "$1"
  notify-send "A Shell Blocker" "$1" -i face-sad-symbolic
  exit 1
}

# Print success via notify-send:
send_success() {
  echo -e "$1"
  notify-send "A Shell Blocker" "$1" -i face-smile-symbolic
}

case $1 in
  about|-a)
    echo -e "\n> A Shell Blocker (ashblock)"
    echo -e "> Block annoying ADs with a simple script."
    echo -e "> Version: 2.0 \"Betelgeuse\""
    echo -e "> License: GPLv2\n"
    ;;
  help|?)
    echo -e "\nUsage: ashblock [about|help|shell]\n"
    echo -e "Options:"
    echo -e "-a | about      See the version and license of this program."
    echo -e "-d | desktop    Run in Desktop mode (default)."
    echo -e "-s | shell      Execute ashblock in Shell mode (not pkexec and notify-send)."
    echo -e " ? | help       This prompt!\n"
    ;;
  shell|-s)
    if [[ ! $(whoami) = root ]]; then
      echo -e "\nYou need to run 'ashblock' as root!\n"
      exit 1
    fi
    curl "$file_source" -o /etc/hosts
    ;;
  ""|desktop|-d)
    pkexec curl "$file_source" -o /etc/hosts
    if [[ $? == 0 ]]; then
      send_success "Done!"
    else
      send_error "Failed!"
    fi
    ;;
esac
