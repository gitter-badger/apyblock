#!/bin/bash
#
# A Shell Blocker
# Block annoying ADs with a single script.
#
# Copyright (C) 2016, Federico Dami√°n Schonborn <federicodamians@gmail.com>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

# Configurations:

# Set the webpage for downloading the /etc/hosts file:
file_source="https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts"

# Functions:

# Print error via notify-send:
send_error() {
  echo -e "$1"
  notify-send "A Shell Blocker" "$1" -i face-sad-symbolic
  exit 1
}

# Print success via notify-send:
send_success() {
  echo -e "$1"
  notify-send "A Shell Blocker" "$1" -i face-smile-symbolic
}

case $1 in
  about|-a)
    echo -e "\n> A Shell Blocker (ashblock)"
    echo -e "> Block annoying ADs with a simple script."
    echo -e "> Version: 2.0 \"Betelgeuse\""
    echo -e "> License: GPLv2\n"
    ;;
  help|?)
    echo -e "\nUsage: ashblock [about|help|shell]\n"
    echo -e "Options:"
    echo -e "-a | about      See the version and license of this program."
    echo -e "-d | desktop    Run in Desktop mode (default)."
    echo -e "-s | shell      Execute ashblock in Shell mode (not pkexec and notify-send)."
    echo -e " ? | help       This prompt!\n"
    ;;
  shell|-s)
    if [[ ! $(whoami) = root ]]; then
      echo -e "\nYou need to run 'ashblock' as root!\n"
      exit 1
    fi
    curl "$file_source" -o /etc/hosts
    ;;
  ""|desktop|-d)
    pkexec curl "$file_source" -o /etc/hosts
    if [[ $? == 0 ]]; then
      send_success "Done!"
    else
      send_error "Failed!"
    fi
    ;;
esac
